"use strict";function makeReport(e,t,r,n,a,i,o){return validate.validateParams(e,t,r,n).then(function(p){if(p)return i.end(i.writeHead(400,p));var l=validate.prepareReportParams(e);return report(l.fullData,l.fullVars,t,a,n).then(function(e){n="csvp"==n?"csv":n;var t="reporte."+n;if(r){var a=path.join(tempFolder,"output."+n),p=[{filename:t,content:e.pipe?fs.createReadStream(a):e}];sendEmail(r,p)}return o?file.write(path.join(tempFolder,t),e).then(function(e){return i.end(e)})["catch"](console.log.bind(console)):("pdf"===n&&(i.setHeader("Content-type","application/pdf"),e.pipe(i)),"csv"===n&&(i.setHeader("Content-type","text/csv"),i.end(e)),"docx"===n&&(i.setHeader("Content-type","application/msword"),e.pipe(i)),void("txt"===n&&(i.setHeader("Content-type","text/plain"),i.end(e))))})})["catch"](console.log.bind(console))}function sendEmail(e,t){email.sendMail({to:e.para,subject:e.asunto,text:e.texto,attachments:t})}function init(e){if(!e)throw new Error("No hay plantillas seleccionadas");return config.plantillas=e,makeReport}var config=require("./config"),report=require("./report"),email=require("./email")(),fs=require("fs"),path=require("path"),file=require("./File"),validate=require("./validate"),tempFolder=path.join(__dirname,"temp"),jsonexport=require("jsonexport");module.exports=init;